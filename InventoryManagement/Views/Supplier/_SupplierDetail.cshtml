@model InventoryManagement.Models.SupplierDetailViewModel

<div class="product-detail-container supplier-detail-modal-content" style="background-color: var(--dark-bg);">
    @* HEADER START *@
    <div class="product-detail-header" style="padding: 15px 25px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
        <div class="left-actions" style="display: flex; align-items: center;">
            <button type="button" class="btn-icon" data-bs-dismiss="modal" aria-label="Back" style="background-color: #1A262D; color: #A0AEC0; border: 1px solid #2E414D; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 8px; margin-right: 20px;">
                <i class="fas fa-arrow-left" style="font-size: 16px;"></i>
            </button>
            <div style="display: flex; align-items: center;">
                @if (Model.Supplier.ProfileImage != null && Model.Supplier.ProfileImage.Length > 0)
                {
                    <img src="@Url.Action("GetSupplierImage", "Supplier", new { id = Model.Supplier.SupplierId })"
                         alt="@Model.Supplier.CompanyName Profile" class="me-3" style="width: 48px; height: 48px; border-radius: 50%; object-fit: cover;"
                         onerror="this.onerror=null; this.src='/images/placeholder-supplier.png';" />
                }
                else
                {
                    <div class="me-3" style="width: 48px; height: 48px; font-size: 1.5em; background-color: @Model.SupplierAvatarColor; border-radius: 50%; display:flex; align-items:center; justify-content:center; font-weight: 500; color:white;">@Model.SupplierAvatarInitial</div>
                }
                <div>
                    <h5 class="modal-title mb-0" id="supplierDetailModalLabel" style="font-size: 1.1rem; font-weight:600; color: var(--text-light);">@Model.Supplier.CompanyName</h5>
                    <small style="color: var(--text-muted); font-size: 0.8rem;">Payables: @Model.CurrencySymbol@Model.TotalPayables.ToString("N2")</small>
                </div>
            </div>
        </div>
        <div class="right-actions" style="display: flex; align-items: center; gap: 8px;">
            <a href="#" class="btn" style="font-size: 13px; padding: 7px 14px; background-color: var(--primary-color); color: var(--dark-bg); border:none; border-radius: 6px; font-weight:500; line-height: 1.5;">New Transaction</a>
            <a asp-action="Edit" asp-controller="Supplier" asp-route-id="@Model.Supplier.SupplierId" class="btn btn-icon" style="background-color: #1A262D; color: #A0AEC0; border: 1px solid #2E414D; width: 36px; height: 36px; border-radius: 8px; display:flex; align-items:center; justify-content:center;">
                <i class="material-icons" style="font-size:20px;">edit</i>
            </a>
            <button type="button" class="btn btn-icon" data-bs-toggle="dropdown" aria-expanded="false" style="background-color: #1A262D; color: #A0AEC0; border: 1px solid #2E414D; width: 36px; height: 36px; border-radius: 8px; display:flex; align-items:center; justify-content:center;">
                <i class="material-icons" style="font-size:20px;">more_horiz</i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">Action 1</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
            </ul>
            <button type="button" class="btn btn-icon nav-arrow-btn" style="background-color: #1A262D; color: #A0AEC0; border: 1px solid #2E414D; width: 36px; height: 36px; border-radius: 8px; display:flex; align-items:center; justify-content:center; margin-left: 5px;">
                <i class="material-icons" style="font-size:22px;">keyboard_arrow_left</i>
            </button>
            <button type="button" class="btn btn-icon nav-arrow-btn" style="background-color: #1A262D; color: #A0AEC0; border: 1px solid #2E414D; width: 36px; height: 36px; border-radius: 8px; display:flex; align-items:center; justify-content:center;">
                <i class="material-icons" style="font-size:22px;">keyboard_arrow_right</i>
            </button>
        </div>
    </div>
    @* HEADER END *@

    <div class="modal-body" style="padding: 20px 25px; background-color: var(--dark-bg); max-height: calc(100vh - 150px); overflow-y: auto;">
        <div class="row gx-4">
            @* LEFT COLUMN START - Added ID and base class modification *@
            <div class="col-md-7" id="supplierDetailLeftColumn">
                @*
                    The ul below uses id="supplierTab" which our new CSS rules target.
                    The buttons use class="nav-link" which Bootstrap and our CSS use.
                    Inline styles for color and border-bottom have been removed from these buttons.
                *@
                <ul class="nav nav-tabs" id="supplierTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="general-info-tab" data-bs-toggle="tab" data-bs-target="#general-info" type="button" role="tab" aria-controls="general-info" aria-selected="true">General Information</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="products-tab-modal" data-bs-toggle="tab" data-bs-target="#products-modal" type="button" role="tab" aria-controls="products-modal" aria-selected="false">Products</button>
                    </li>
                </ul>

                <div class="tab-content" id="supplierTabContent">
                    <div class="tab-pane fade show active" id="general-info" role="tabpanel" aria-labelledby="general-info-tab">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 style="font-size: 1.2rem; font-weight: 600; color: var(--text-light);">@Model.Supplier.CompanyName</h4>
                            <a href="#" class="text-decoration-none" style="color: var(--primary-color); font-size: 0.8rem; font-weight:500;">
                                <i class="material-icons" style="font-size: 16px; vertical-align: bottom; margin-right:2px;">add</i> Add Address
                            </a>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.Supplier.Address))
                        {
                            <div class="p-3 rounded mb-4" style="background-color: var(--card-bg); border: 1px solid var(--border-color); padding: 15px !important; border-radius: 8px;">
                                <h6 class="mb-1" style="font-size: 0.75rem; text-transform: uppercase; color: var(--text-gray); font-weight:500;">Billing Address</h6>
                                <p class="mb-0" style="font-size: 0.85rem; color: var(--text-light); line-height:1.4;">@Model.Supplier.Address</p>
                            </div>
                        }

                        <h5 class="mb-3" style="font-size: 1.1rem; font-weight: 600; color: var(--text-light); margin-top:25px;">Purchasing info</h5>
                        <div class="info-grid mb-4" style="display: flex; flex-direction: column; gap: 8px;">
                            <div class="info-row" style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="info-label" style="color: var(--text-gray); font-size:0.8rem; text-transform:uppercase; width:40%;">Currency</span>
                                <span class="info-value" style="color: var(--text-light); font-size:0.85rem; width:60%; text-align:right;">@Model.Supplier.Currency</span>
                            </div>
                            <div class="info-row" style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="info-label" style="color: var(--text-gray); font-size:0.8rem; text-transform:uppercase; width:40%;">Payment Method</span>
                                <span class="info-value" style="color: var(--text-light); font-size:0.85rem; width:60%; text-align:right;">@Model.Supplier.PaymentMethod</span>
                            </div>
                            @if (Model.Supplier.GetType().GetProperty("PriceIncludeTaxes") != null)
                            {
                                <div class="info-row" style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="info-label" style="color: var(--text-gray); font-size:0.8rem; text-transform:uppercase; width:40%;">Price Include Taxes</span>
                                    <span class="info-value" style="color: var(--text-light); font-size:0.85rem; width:60%; text-align:right;">@((bool)Model.Supplier.GetType().GetProperty("PriceIncludeTaxes").GetValue(Model.Supplier, null) ? "Yes" : "No")</span>
                                </div>
                            }
                        </div>

                        <h5 class="mb-3" style="font-size: 1.1rem; font-weight: 600; color: var(--text-light); margin-top:25px;">Other Details</h5>
                        <div class="info-grid" style="display: flex; flex-direction: column; gap: 8px;">
                            <div class="info-row" style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="info-label" style="color: var(--text-gray); font-size:0.8rem; text-transform:uppercase; width:40%;">Courier</span>
                                <span class="info-value" style="color: var(--text-light); font-size:0.85rem; width:60%; text-align:right;">@Model.Supplier.Courier</span>
                            </div>
                            <div class="info-row" style="display: flex; justify-content: space-between; align-items: center;">
                                <span class="info-label" style="color: var(--text-gray); font-size:0.8rem; text-transform:uppercase; width:40%;">Portal Status</span>
                                <span class="info-value" style="width:60%; text-align:right;">
                                    <span class="status-badge" style="background-color: @(Model.Supplier.PortalStatus?.ToLower() == "active" ? "var(--primary-color)" : "#4A5568"); color: @(Model.Supplier.PortalStatus?.ToLower() == "active" ? "var(--dark-bg)" : "white"); padding: 3px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">@Model.Supplier.PortalStatus</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="products-modal" role="tabpanel" aria-labelledby="products-tab-modal" style="padding-top: 20px;">
                        <div class="d-flex align-items-center mb-4">
                            <h5 style="font-size: 1.15rem; font-weight: 600; color: var(--text-light); margin-bottom: 0; margin-right: 10px;">Total Products</h5>
                            <span style="background-color: var(--card-bg); color: var(--text-light); padding: 4px 10px; border-radius: 6px; font-size: 0.9rem; font-weight: 500; border: 1px solid var(--border-color);">
                                @(Model.SupplierProducts?.Count ?? 0)
                            </span>
                        </div>

                        <div class="mb-4 position-relative">
                            <label for="productSearchSupplierModal" class="form-label" style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px; display:block; font-weight:500;">Add Product to Supplier</label>
                            <div class="input-group" style="background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; display:flex; align-items:center; padding: 0 12px;">
                                <i class="material-icons" style="color: var(--text-muted); font-size: 22px; margin-right: 8px;">search</i>
                                <input type="text" id="productSearchSupplierModal" class="form-control" placeholder="Search product by name or ID..." style="background-color: transparent; border: none; color: var(--text-light); height: 42px; padding-left:0; box-shadow:none;">
                                <button class="btn btn-icon" style="background-color: transparent; color: var(--text-muted); border: none; padding: 0; margin-left: auto;" onclick="document.getElementById('productSearchSupplierModal').value = ''; document.getElementById('productSearchSupplierModal').focus(); return false;">
                                    <i class="material-icons" style="font-size: 20px;">close</i>
                                </button>
                            </div>
                        </div>

                        <div class="supplier-product-list" style="max-height: 300px; overflow-y: auto; padding-right:5px;">
                            @if (Model.SupplierProducts != null && Model.SupplierProducts.Any())
                            {
                                foreach (var product_view in Model.SupplierProducts)
                                {
                                    <div class="supplier-product-item d-flex align-items-center p-3 mb-2" style="background-color: var(--card-bg); border-radius: 8px; border: 1px solid var(--border-color);">
                                        <div class="d-flex align-items-center" style="width: 35%; min-width: 280px;">
                                            <img src="@(string.IsNullOrEmpty(product_view.ImageUrl) ? "/images/placeholder-product.png" : product_view.ImageUrl)"
                                                 alt="@product_view.Name"
                                                 style="width: 48px; height: 48px; border-radius: 6px; object-fit: cover; background-color: white; padding:2px; margin-right: 15px;"
                                                 onerror="this.onerror=null; this.src='/images/placeholder-product.png';">
                                            <div>
                                                <h6 class="mb-0" style="font-size: 0.9rem; font-weight: 600; color: var(--text-light); line-height:1.3;">@product_view.Name</h6>
                                                <small style="font-size: 0.75rem; color: var(--text-muted); display:block;">ID: @product_view.Id</small>
                                                <div class="d-flex align-items-center mt-1">
                                                    <i class="material-icons me-1" style="font-size: 14px; color: var(--text-gray);">inventory_2</i>
                                                    <span style="font-size: 0.75rem; color: var(--text-gray);">@product_view.StockStatus</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="product-details-grid d-flex flex-grow-1 justify-content-around align-items-center" style="font-size: 0.8rem; color: var(--text-muted); padding-left: 15px; padding-right: 15px;">
                                            <div style="min-width: 90px; text-align:left;">
                                                <div style="font-size: 0.7rem; text-transform: uppercase; margin-bottom:3px; color: var(--text-gray);">Supplier Code</div>
                                                <div style="color: var(--text-light); font-size:0.85rem;">SUP-@(product_view.Id.ToString("D3"))</div>
                                            </div>
                                            <div style="min-width: 70px; text-align:left;">
                                                <div style="font-size: 0.7rem; text-transform: uppercase; margin-bottom:3px; color: var(--text-gray);">Quantity</div>
                                                <div style="color: var(--text-light); font-size:0.85rem;">@product_view.Stock</div>
                                            </div>
                                            <div style="min-width: 90px; text-align:left;">
                                                <div style="font-size: 0.7rem; text-transform: uppercase; margin-bottom:3px; color: var(--text-gray);">Reorder Point</div>
                                                <div style="color: var(--text-light); font-size:0.85rem;">@((product_view.Stock ?? 0) > 50 ? 20 : ((product_view.Stock ?? 0) > 0 ? 10 : 5))</div>
                                            </div>
                                            <div style="min-width: 90px; text-align:left;">
                                                <div style="font-size: 0.7rem; text-transform: uppercase; margin-bottom:3px; color: var(--text-gray);">Purchase Price</div>
                                                <div style="color: var(--text-light); font-size:0.85rem;">
                                                    @if (product_view.Price.HasValue)
                                                    {
                                                        @Model.CurrencySymbol @product_view.Price.Value.ToString("N2")
                                                    }
                                                    else
                                                    {
                                                        <span>N/A</span>
                                                    }
                                                </div>
                                            </div>
                                        </div>

                                        <button class="btn btn-icon ms-auto" style="background-color: #2E3A4B; color: #A0AEC0; border:none; width:36px; height:36px; min-width:36px; border-radius:8px; display:flex; align-items:center; justify-content:center;">
                                            <i class="material-icons" style="font-size:20px;">more_horiz</i>
                                        </button>
                                    </div>
                                }
                            }
                            else
                            {
                                <p style="color: var(--text-muted); text-align: center; padding: 20px 0;">This supplier currently has no associated products.</p>
                            }
                        </div>
                    </div>
                </div>
            </div>
            @* LEFT COLUMN END *@

            @* RIGHT COLUMN START - Added ID *@
            <div class="col-md-5" id="supplierDetailRightColumn">
                @if (Model.PrimaryContact != null)
                {
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 style="font-size: 1.1rem; font-weight: 600; color: var(--text-light);">Contact Person</h5>
                        <a href="#" class="text-decoration-none" style="color: var(--primary-color); font-size: 0.8rem; font-weight:500;">
                            <i class="material-icons" style="font-size: 16px; vertical-align: bottom; margin-right:2px;">add</i> Add Contact
                        </a>
                    </div>
                    <div class="p-3 rounded mb-4" style="background-color: var(--card-bg); border: 1px solid var(--border-color); padding: 15px !important; border-radius: 8px;">
                        <div class="d-flex align-items-center mb-3">
                            <div class="me-3" style="width: 40px; height: 40px; font-size: 1.2em; background-color: @Model.PrimaryContactAvatarColor; border-radius: 50%; display:flex; align-items:center; justify-content:center; font-weight: 500; color:white;">@Model.PrimaryContactAvatarInitial</div>
                            <div>
                                <h6 class="mb-0" style="font-size: 0.95rem; font-weight:500; color:var(--text-light);">@Model.PrimaryContact.ContactPersonName</h6>
                                <small style="color: var(--text-muted); font-size:0.75rem;">@Model.Supplier.Department</small>
                            </div>
                            <span class="badge ms-auto" style="background-color: #374151; color: white; font-size:0.7rem; padding: 4px 8px; border-radius: 6px; font-weight:500;">Primary</span>
                        </div>
                        <div class="info-grid mb-3" style="display: flex; flex-direction: column; gap: 8px;">
                            @if (!string.IsNullOrWhiteSpace(Model.Supplier.Department))
                            {
                                <div class="info-row" style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="info-label" style="color: var(--text-gray); font-size:0.75rem; text-transform:uppercase;">Department</span>
                                    <span class="info-value" style="color: var(--text-light); font-size:0.85rem; text-align:right;">@Model.Supplier.Department</span>
                                </div>
                            }
                            @if (!string.IsNullOrWhiteSpace(Model.PrimaryContact.Email))
                            {
                                <div class="info-row" style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="info-label" style="color: var(--text-gray); font-size:0.75rem; text-transform:uppercase;">Email</span>
                                    <span class="info-value" style="text-align:right;"><a href="mailto:@Model.PrimaryContact.Email" class="text-decoration-none" style="color: var(--text-light); font-size:0.85rem;">@Model.PrimaryContact.Email</a></span>
                                </div>
                            }
                            @if (!string.IsNullOrWhiteSpace(Model.PrimaryContact.PhoneNumber))
                            {
                                <div class="info-row" style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="info-label" style="color: var(--text-gray); font-size:0.75rem; text-transform:uppercase;">Phone</span>
                                    <span class="info-value" style="color: var(--text-light); font-size:0.85rem; text-align:right;">@Model.PrimaryContact.PhoneNumber</span>
                                </div>
                            }
                        </div>
                        <div class="d-flex justify-content-end gap-2 mt-3">
                            <button class="btn btn-icon" style="background-color: #2E3A4B; color: #A0AEC0; border:none; width:32px; height:32px; border-radius:6px; display:flex; align-items:center; justify-content:center;"><i class="material-icons" style="font-size:18px;">settings</i></button>
                            <button class="btn btn-icon" style="background-color: #2E3A4B; color: #A0AEC0; border:none; width:32px; height:32px; border-radius:6px; display:flex; align-items:center; justify-content:center;"><i class="material-icons" style="font-size:18px;">more_horiz</i></button>
                            @if (!string.IsNullOrWhiteSpace(Model.PrimaryContact.Email))
                            {
                                <a href="mailto:@Model.PrimaryContact.Email" class="btn" style="background-color: var(--primary-color); color: var(--dark-bg); font-size: 0.8rem; padding: 6px 12px; border-radius:6px; font-weight:500;">Send Email</a>
                            }
                        </div>
                    </div>
                }

                @if (Model.OtherContacts != null && Model.OtherContacts.Any())
                {
                    <h5 class="mb-2" style="font-size: 1.1rem; font-weight: 600; color: var(--text-light); margin-top:25px;">Other Contact Persons</h5>
                    @foreach (var contact in Model.OtherContacts)
                    {
                        <div class="p-3 rounded mb-3" style="background-color: var(--card-bg); border: 1px solid var(--border-color); padding: 15px !important; border-radius: 8px;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-2" style="font-size: 0.95rem; font-weight:500; color:var(--text-light);">@contact.ContactPersonName</h6>
                                <button class="btn btn-icon btn-sm" style="background-color: transparent; color: var(--text-muted); border: none; padding: 0;">
                                    <i class="material-icons" style="font-size: 18px;">more_horiz</i>
                                </button>
                            </div>
                            <div class="info-grid" style="display: flex; flex-direction: column; gap: 6px;">
                                @if (!string.IsNullOrWhiteSpace(contact.Email))
                                {
                                    <div class="info-row" style="display: flex; align-items: center;">
                                        <span class="info-label" style="color: var(--text-gray); width:auto; margin-right:8px; font-size:0.75rem; text-transform:uppercase;">Email:</span>
                                        <span class="info-value flex-grow-1"><a href="mailto:@contact.Email" class="text-decoration-none" style="color: var(--text-light); font-size:0.85rem;">@contact.Email</a></span>
                                    </div>
                                }
                                @if (!string.IsNullOrWhiteSpace(contact.PhoneNumber))
                                {
                                    <div class="info-row" style="display: flex; align-items: center;">
                                        <span class="info-label" style="color: var(--text-gray); width:auto; margin-right:8px; font-size:0.75rem; text-transform:uppercase;">Phone:</span>
                                        <span class="info-value flex-grow-1" style="color: var(--text-light); font-size:0.85rem;">@contact.PhoneNumber</span>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                }
                else if (Model.PrimaryContact != null)
                {
                    <div class="text-center mt-3">
                        <a href="#" class="text-decoration-none" style="color: var(--primary-color); font-size: 0.9rem;">
                            <i class="material-icons" style="font-size: 18px; vertical-align: middle;">add</i> Add Another Contact
                        </a>
                    </div>
                }
            </div>
            @* RIGHT COLUMN END *@
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const generalInfoTabButton = document.getElementById('general-info-tab');
            const productsTabButton = document.getElementById('products-tab-modal');
            const leftColumn = document.getElementById('supplierDetailLeftColumn');
            const rightColumn = document.getElementById('supplierDetailRightColumn');

            function adjustLayout() {
                if (!leftColumn || !rightColumn || !productsTabButton || !generalInfoTabButton) {
                    // console.warn('Supplier detail modal: One or more layout elements not found.');
                    return;
                }

                if (productsTabButton.classList.contains('active')) {
                    // Products tab is active
                    if (rightColumn) rightColumn.style.display = 'none';
                    if (leftColumn) {
                        leftColumn.classList.remove('col-md-7');
                        leftColumn.classList.add('col-md-12');
                    }
                } else if (generalInfoTabButton.classList.contains('active')) {
                    // General Info tab is active
                    if (rightColumn) rightColumn.style.display = ''; // Revert to default display
                    if (leftColumn) {
                        leftColumn.classList.remove('col-md-12');
                        leftColumn.classList.add('col-md-7');
                    }
                } else {
                    // Fallback: if somehow neither is explicitly active, assume general info layout
                    if (rightColumn) rightColumn.style.display = '';
                    if (leftColumn) {
                        leftColumn.classList.remove('col-md-12');
                        leftColumn.classList.add('col-md-7');
                    }
                }
            }

            // Initial layout adjustment on load
            adjustLayout();

            // Listen for tab show events (Bootstrap 5)
            if (productsTabButton) {
                productsTabButton.addEventListener('shown.bs.tab', function (event) {
                    adjustLayout();
                });
            }

            if (generalInfoTabButton) {
                generalInfoTabButton.addEventListener('shown.bs.tab', function (event) {
                    adjustLayout();
                });
            }
        });
    </script>
}